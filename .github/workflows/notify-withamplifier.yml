name: Notify withamplifier to sync

on:
  push:
    paths:
      - 'docs/**'
    branches:
      - master
  workflow_dispatch: # Allow manual trigger

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Trigger withamplifier sync
        run: |
          echo "Triggering withamplifier sync-decks workflow..."
          
          curl -X POST \
            -H "Accept: application/vnd.github+json" \
            -H "Authorization: Bearer ${{ secrets.WITHAMPLIFIER_PAT }}" \
            -H "X-GitHub-Api-Version: 2022-11-28" \
            https://api.github.com/repos/anderlpz/withamplifier/dispatches \
            -d '{"event_type":"sync-decks","client_payload":{"source":"samueljklee/amplifier-stories","triggered_by":"${{ github.actor }}","commit":"${{ github.sha }}"}}'
          
          echo "âœ… Triggered withamplifier sync-decks workflow"
          echo ""
          echo "The withamplifier repo will now:"
          echo "  1. Pull latest docs from this repo"
          echo "  2. Transform HTML files (inject CSS, fix links)"
          echo "  3. Generate deck metadata with isNew detection"
          echo "  4. Commit and deploy to withamplifier.com"
